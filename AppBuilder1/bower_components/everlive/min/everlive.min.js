/*!
The MIT License (MIT)

Copyright (c) 2013 Telerik AD

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.y distributed under the MIT license.
*/
/*!
 Everlive SDK
 Version 1.2.14
 */
(function(b,c){if(typeof define==="function"&&define.amd){define(["underscore","rsvp","reqwest","jstz"],function(i,h,f,g){return(b.Everlive=c(i,h,f,g))})}else{if(typeof(isNativeScriptApplication)!=="undefined"&&isNativeScriptApplication){var e={Promise:Promise};b.RSVP=e;var d=require("http");var a=function(g){var j={url:g.url,method:g.method,headers:g.headers||{}};if(g.data){j.content=g.data}j.headers.Accept="application/json";j.headers["Content-Type"]="application/json";var h=function(){};var i=g.success||h;var f=g.error||h;d.request(j).then(function(k){var l=k.content.toString();if(k.statusCode<400){i(l)}else{f({responseText:l})}},function(k){f({responseText:k})})};b.reqwest=a;module.exports=c(exports._,b.RSVP,b.reqwest,exports.jstz)}else{if(typeof exports==="object"){module.exports=c(require("underscore"),require("rsvp"))}else{b.Everlive=c(b._,b.RSVP,b.reqwest,b.jstz)}}}}(this,function(B,k,m,h){var q=Array.prototype.slice;var E="//api.everlive.com/v1/";var i="Id";function a(H,F,G){if(!G){G="The "+F+" is required"}if(typeof H==="undefined"||H===null){throw new c(G)}}function x(F){this.url=E;this.apiKey=null;this.masterKey=null;this.token=null;this.tokenType=null;this.scheme="http";this.parseOnlyCompleteDateTimeObjects=false;if(typeof F==="string"){this.apiKey=F}else{this._emulatorMode=F.emulatorMode;B.extend(this,F)}}function s(G){var F=this;this.setup=new x(G);B.each(t,function(H){H.func.call(F,G)});if(s.$===null){s.$=F}}s.$=null;s.idField=i;var t=[];s.initializations=t;s.init=function(F){s.$=null;return new s(F)};s.buildUrl=function(F){var G="";if(typeof F.scheme==="string"){G+=F.scheme+":"}G+=F.url;if(F.apiKey){G+=F.apiKey+"/"}return G};s.prototype.data=function(F){return new f(this.setup,F)};s.prototype.buildUrl=function(){return s.buildUrl(this.setup)};var r=function(G,H){var F=null;if(H&&H.authHeaders===false){return F}if(G.token){F=(G.tokenType||"bearer")+" "+G.token}else{if(G.masterKey){F="masterkey "+G.masterKey}}if(F){return{Authorization:F}}else{return null}};s.prototype.buildAuthHeader=function(){return r(this.setup)};(function(){var L={query:1,where:100,filter:101,and:110,or:111,not:112,equal:120,not_equal:121,lt:122,lte:123,gt:124,gte:125,isin:126,notin:127,all:128,size:129,regex:130,contains:131,startsWith:132,endsWith:133,nearShpere:140,withinBox:141,withinPolygon:142,withinShpere:143,select:200,exclude:201,order:300,order_desc:301,skip:400,take:401,expand:402};function H(M,N){this.operator=M;this.operands=N||[]}H.prototype={addOperand:function(M){this.operands.push(M)}};function G(Q,M,O,R,N,P){this.filter=Q;this.fields=M;this.sort=O;this.toskip=R;this.totake=N;this.expandExpression=P;this.expr=new H(L.query)}G.prototype={where:function(M){if(M){return this._simple(L.filter,[M])}else{return new K(this)}},select:function(){return this._simple(L.select,arguments)},order:function(M){return this._simple(L.order,[M])},orderDesc:function(M){return this._simple(L.order_desc,[M])},skip:function(M){return this._simple(L.skip,[M])},take:function(M){return this._simple(L.take,[M])},expand:function(M){return this._simple(L.expand,[M])},build:function(){return new J(this).build()},_simple:function(O,M){var N=q.call(M);this.expr.addOperand(new H(O,N));return this}};function K(O,N,M){this.parent=O;this.single=M;this.expr=new H(N||L.where);this.parent.expr.addOperand(this.expr)}K.prototype={and:function(){return new K(this,L.and)},or:function(){return new K(this,L.or)},not:function(){return new K(this,L.not,true)},_simple:function(M){var N=q.call(arguments,1);this.expr.addOperand(new H(M,N));return this._done()},eq:function(N,M){return this._simple(L.equal,N,M)},ne:function(N,M){return this._simple(L.not_equal,N,M)},gt:function(N,M){return this._simple(L.gt,N,M)},gte:function(N,M){return this._simple(L.gte,N,M)},lt:function(N,M){return this._simple(L.lt,N,M)},lte:function(N,M){return this._simple(L.lte,N,M)},isin:function(N,M){return this._simple(L.isin,N,M)},notin:function(N,M){return this._simple(L.notin,N,M)},all:function(N,M){return this._simple(L.all,N,M)},size:function(N,M){return this._simple(L.size,N,M)},regex:function(O,N,M){return this._simple(L.regex,O,N,M)},startsWith:function(O,N,M){return this._simple(L.startsWith,O,N,M)},endsWith:function(O,N,M){return this._simple(L.endsWith,O,N,M)},nearSphere:function(O,M,P,N){return this._simple(L.nearShpere,O,M,P,N)},withinBox:function(N,O,M){return this._simple(L.withinBox,N,O,M)},withinPolygon:function(N,M){return this._simple(L.withinPolygon,N,M)},withinCenterSphere:function(P,N,M,O){return this._simple(L.withinShpere,P,N,M,O)},done:function(){if(this.parent instanceof K){return this.parent._done()}else{return this.parent}},_done:function(){if(this.single){return this.parent}else{return this}}};K.prototype.equal=K.prototype.eq;K.prototype.notEqual=K.prototype.ne;K.prototype.greaterThan=K.prototype.gt;K.prototype.greaterThanEqual=K.prototype.gte;K.prototype.lessThan=K.prototype.lt;K.prototype.lessThanEqual=K.prototype.lte;function J(M){this.query=M;this.expr=M.expr}var F={radians:"$maxDistance",km:"$maxDistanceInKilometers",miles:"$maxDistanceInMiles"};var I={radians:"radius",km:"radiusInKilometers",miles:"radiusInMiles"};J.prototype={build:function(){var M=this.query;if(M.filter||M.fields||M.sort||M.toskip||M.totake||M.expandExpression){return{$where:M.filter||null,$select:M.fields||null,$sort:M.sort||null,$skip:M.toskip||null,$take:M.totake||null,$expand:M.expandExpression||null}}return{$where:this._buildWhere(),$select:this._buildSelect(),$sort:this._buildSort(),$skip:this._getSkip(),$take:this._getTake(),$expand:this._getExpand()}},_getSkip:function(){var M=B.find(this.expr.operands,function(P,N,O){return P.operator===L.skip});return M?M.operands[0]:null},_getTake:function(){var M=B.find(this.expr.operands,function(P,N,O){return P.operator===L.take});return M?M.operands[0]:null},_getExpand:function(){var M=B.find(this.expr.operands,function(P,N,O){return P.operator===L.expand});return M?M.operands[0]:null},_buildSelect:function(){var N=B.find(this.expr.operands,function(Q,O,P){return Q.operator===L.select});var M={};if(N){B.reduce(N.operands,function(O,P){O[P]=1;return O},M);return M}else{return null}},_buildSort:function(){var N=B.filter(this.expr.operands,function(Q,O,P){return Q.operator===L.order||Q.operator===L.order_desc});var M={};if(N.length>0){B.reduce(N,function(O,P){O[P.operands[0]]=P.operator===L.order?1:-1;return O},M);return M}else{return null}},_buildWhere:function(){var M=B.find(this.expr.operands,function(Q,O,P){return Q.operator===L.where});if(M){return this._build(new H(L.and,M.operands))}else{var N=B.find(this.expr.operands,function(Q,O,P){return Q.operator===L.filter});if(N){return N.operands[0]}return null}},_build:function(M){if(this._isSimple(M)){return this._simple(M)}else{if(this._isRegex(M)){return this._regex(M)}else{if(this._isGeo(M)){return this._geo(M)}else{if(this._isAnd(M)){return this._and(M)}else{if(this._isOr(M)){return this._or(M)}else{if(this._isNot(M)){return this._not(M)}}}}}}},_isSimple:function(M){return M.operator>=L.equal&&M.operator<=L.size},_simple:function(Q){var P={},M={};var O=Q.operands;var N=this._translateoperator(Q.operator);if(N){P[N]=O[1]}else{P=O[1]}M[O[0]]=P;return M},_isRegex:function(M){return M.operator>=L.regex&&M.operator<=L.endsWith},_regex:function(Q){var M={};var P=this._getRegex(Q);var N=this._getRegexValue(P);var O=Q.operands;M[O[0]]=N;return M},_getRegex:function(O){var N=O.operands[1];var M=O.operands[2]?O.operands[2]:"";switch(O.operator){case L.regex:return N instanceof RegExp?N:new RegExp(N,M);case L.startsWith:return new RegExp("^"+N,M);case L.endsWith:return new RegExp(N+"$",M);default:throw new c("Unknown operator type.")}},_getRegexValue:function(N){var M="";if(N.global){M+="g"}if(N.multiline){M+="m"}if(N.ignoreCase){M+="i"}return{$regex:N.source,$options:M}},_isGeo:function(M){return M.operator>=L.nearShpere&&M.operator<=L.withinShpere},_geo:function(O){var M={};var N=O.operands;M[N[0]]=this._getGeoTerm(O);return M},_getGeoTerm:function(M){switch(M.operator){case L.nearShpere:return this._getNearSphereTerm(M);case L.withinBox:return this._getWithinBox(M);case L.withinPolygon:return this._getWithinPolygon(M);case L.withinShpere:return this._getWithinCenterSphere(M);default:throw new c("Unknown operator type.")}},_getNearSphereTerm:function(S){var O=S.operands;var M=this._getGeoPoint(O[1]);var R=O[2];var Q=O[3];var N;var P={"$nearSphere":M};if(typeof R!=="undefined"){N=F[Q]||F.radians;P[N]=R}return P},_getWithinBox:function(P){var N=P.operands;var M=this._getGeoPoint(N[1]);var O=this._getGeoPoint(N[2]);return{"$within":{"$box":[M,O]}}},_getWithinPolygon:function(O){var M=O.operands;var N=this._getGeoPoints(M[1]);return{"$within":{"$polygon":N}}},_getWithinCenterSphere:function(S){var Q=S.operands;var N=this._getGeoPoint(Q[1]);var M=Q[2];var R=Q[3];var O=I[R]||I.radians;var P={center:N};P[O]=M;return{"$within":{"$centerSphere":P}}},_getGeoPoint:function(M){if(B.isArray(M)){return new n(M[0],M[1])}return M},_getGeoPoints:function(N){var M=this;return B.map(N,function(O){return M._getGeoPoint(O)})},_isAnd:function(M){return M.operator===L.and},_and:function(R){var Q,N,P,M={};var O=R.operands;for(Q=0,N=O.length;Q<N;Q++){P=this._build(O[Q]);M=this._andAppend(M,P)}return M},_andAppend:function(Q,N){var P,M,O,S,T;var R=B.keys(N);for(P=0,M=R.length;P<M;P++){O=R[P];S=Q[O];if(typeof S==="undefined"){Q[O]=N[O]}else{T=N[O];if(typeof S==="object"&&typeof T==="object"){S=B.extend(S,T)}else{S=T}Q[O]=S}}return Q},_isOr:function(M){return M.operator===L.or},_or:function(R){var Q,N,P,M=[];var O=R.operands;for(Q=0,N=O.length;Q<N;Q++){P=this._build(O[Q]);M.push(P)}return{$or:M}},_isNot:function(M){return M.operator===L.not},_not:function(M){return{$not:this._build(M.operands[0])}},_translateoperator:function(M){switch(M){case L.equal:return null;case L.not_equal:return"$ne";case L.gt:return"$gt";case L.lt:return"$lt";case L.gte:return"$gte";case L.lte:return"$lte";case L.isin:return"$in";case L.notin:return"$nin";case L.all:return"$all";case L.size:return"$size"}throw new c("Unknown operator type.")}};s.Query=G;s.QueryBuilder=J}());var w=(function(){var Q={filter:"X-Everlive-Filter",select:"X-Everlive-Fields",sort:"X-Everlive-Sort",skip:"X-Everlive-Skip",take:"X-Everlive-Take",expand:"X-Everlive-Expand"};var M=null;function G(T,U){a(T,"setup");a(U,"options");this.setup=T;this.method=null;this.endpoint=null;this.data=null;this.headers={};this.success=null;this.error=null;this.parse=G.parsers.simple;B.extend(this,U);this._init(U);M=this}G.prototype={send:function(){s.sendRequest(this)},buildAuthHeader:r,buildUrl:function O(T){return s.buildUrl(T)},buildQueryHeaders:function J(T){if(T){if(T instanceof s.Query){return G.prototype._buildQueryHeaders(T)}else{return G.prototype._buildFilterHeader(T)}}else{return{}}},_init:function(T){B.extend(this.headers,this.buildAuthHeader(this.setup,T),this.buildQueryHeaders(T.filter),T.headers)},_buildQueryHeaders:function(T){T=T.build();var U={};if(T.$where!==null){U[Q.filter]=JSON.stringify(T.$where)}if(T.$select!==null){U[Q.select]=JSON.stringify(T.$select)}if(T.$sort!==null){U[Q.sort]=JSON.stringify(T.$sort)}if(T.$skip!==null){U[Q.skip]=T.$skip}if(T.$take!==null){U[Q.take]=T.$take}if(T.$expand!==null){U[Q.expand]=JSON.stringify(T.$expand)}return U},_buildFilterHeader:function(T){var U={};U[Q.filter]=JSON.stringify(T);return U}};s.Request=G;var S={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"};s.prototype.request=function(T){return new G(this.setup,T)};function R(X){if(M&&M.setup&&M.setup.parseOnlyCompleteDateTimeObjects){if(/^\d{4}-\d{2}-\d{2}$/.test(X)){return null}if(/^(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2})))?$/.test(X)){return null}}var W;if(W=X.match(/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?))$/)){var U=W[12];if(U){if(U.length>3){U=Math.round(Number(U.substr(0,3)+"."+U.substr(3)))}else{if(U.length<3){U+=U.length===2?"0":"00"}}}var V=new Date(Date.UTC(Number(W[1]),(Number(W[3])-1)||0,Number(W[5])||0,Number(W[7])||0,Number(W[8])||0,Number(W[10])||0,Number(U)||0));if(W[13]&&W[13]!=="Z"){var Y=Number(W[16])||0,T=Number(W[17])||0;Y*=3600000;T*=60000;var Z=Y+T;if(W[15]==="+"){Z=-Z}V=new Date(V.valueOf()+Z)}return V}else{return null}}function N(U,V){if(typeof V==="string"){var T=R(V);if(T){V=T}}return V}function K(X,U){var T,V,W;for(T in X){if(X.hasOwnProperty(T)){V=X[T];W=U(T,V);X[T]=W;if(V===W&&typeof V==="object"){K(V,U)}}}}function F(T){K(T,N)}s._traverseAndRevive=F;function H(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,N)}else{if(typeof T==="object"){F(T)}}if(T){return{result:T.Result,count:T.Count}}else{return T}}function I(T){if(typeof T==="string"&&T.length>0){try{T=JSON.parse(T);return{message:T.message,code:T.errorCode}}catch(U){return T}}else{return T}}function P(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,N)}else{if(typeof T==="object"){F(T)}}if(T){return{result:T.Result}}else{return T}}function L(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,N)}else{if(typeof T==="object"){F(T)}}if(T){return{result:T.Result,ModifiedAt:T.ModifiedAt}}else{return T}}G.parsers={simple:{result:H,error:I},single:{result:P,error:I},update:{result:L,error:I}};s.disableRequestCache=function(T,W){if(W==="GET"){var U=(new Date()).getTime();var V=T.indexOf("?")>-1?"&":"?";T+=V+"_el="+U}return T};if(typeof s.sendRequest==="undefined"){s.sendRequest=function(U){var T=U.buildUrl(U.setup)+U.endpoint;T=s.disableRequestCache(T,U.method);var V=U.method==="GET"?U.data:JSON.stringify(U.data);m({url:T,method:U.method,data:V,headers:U.headers,type:"json",contentType:"application/json",crossOrigin:true,success:function(X,Y,W){U.success.call(U,U.parse.result(X))},error:function(W,Y,X){U.error.call(U,U.parse.error(W.responseText))}})}}return G}());s.getCallbacks=function(H,F){var G;if(typeof H!=="function"&&typeof F!=="function"){G=new k.Promise(function(J,I){H=function(K){J(K)};F=function(K){I(K)}})}return{promise:G,success:H,error:F}};function v(F,I,G){var H=s.getCallbacks(I,G);F(H.success,H.error);return H.promise}function A(F,G){return function(J,H){var I=J.result;if(B.isArray(F)||typeof F.length==="number"){B.each(F,function(L,K){B.extend(L,I[K])})}else{B.extend(F,I)}G(J,H)}}function l(F,G){return function(I){var H=I.ModifiedAt;F.ModifiedAt=H;G(I)}}function f(F,G){this.setup=F;this.collectionName=G;this.options=null}f.prototype={withHeaders:function(G){var F=this.options||{};F.headers=B.extend(F.headers||{},G);this.options=F;return this},expand:function(G){var F={"X-Everlive-Expand":JSON.stringify(G)};return this.withHeaders(F)},_createRequest:function(F){B.extend(F,this.options);this.options=null;return new w(this.setup,F)},get:function(H,I,G){var F=this;return v(function(L,J){var K=F._createRequest({method:"GET",endpoint:F.collectionName,filter:H,success:L,error:J});K.send()},I,G)},getById:function(I,H,G){var F=this;return v(function(L,J){var K=F._createRequest({method:"GET",endpoint:F.collectionName+"/"+I,parse:w.parsers.single,success:L,error:J});K.send()},H,G)},count:function(H,I,G){var F=this;return v(function(L,J){var K=F._createRequest({method:"GET",endpoint:F.collectionName+"/_count",filter:H,parse:w.parsers.single,success:L,error:J});K.send()},I,G)},create:function(H,I,G){var F=this;return v(function(L,J){var K=F._createRequest({method:"POST",endpoint:F.collectionName,data:H,parse:w.parsers.single,success:A(H,L),error:J});K.send()},I,G)},rawUpdate:function(H,I,J,G){var F=this;return v(function(O,L){var N=F.collectionName;var K=null;if(typeof I==="string"){N+="/"+I}else{if(typeof I==="object"){K=I}}var M=F._createRequest({method:"PUT",endpoint:N,data:H,filter:K,success:O,error:L});M.send()},J,G)},_update:function(H,J,L,I,K,G){var F=this;return v(function(R,M){var Q=F.collectionName;var O=R;if(L){Q+="/"+H[i];O=l(H,R)}var P={};P[I?"$replace":"$set"]=H;var N=F._createRequest({method:"PUT",endpoint:Q,parse:w.parsers.update,data:P,filter:J,success:O,error:M});N.send()},K,G)},updateSingle:function(G,H,F){return this._update(G,null,true,false,H,F)},update:function(G,H,I,F){return this._update(G,H,false,false,I,F)},_destroy:function(H,I,K,J,G){var F=this;return v(function(O,L){var N=F.collectionName;if(K){N+="/"+H[i]}var M=F._createRequest({method:"DELETE",endpoint:N,filter:I,success:O,error:L});M.send()},J,G)},destroySingle:function(G,H,F){return this._destroy(G,null,true,H,F)},destroy:function(G,H,F){return this._destroy(null,G,false,H,F)},setAcl:function(J,H,I,G){var F=this;return v(function(O,K){var N=F.collectionName;if(typeof H==="string"){N+="/"+H}else{if(typeof H==="object"){N+="/"+H[i]}}N+="/_acl";var P,M;if(J===null){P="DELETE"}else{P="PUT";M=J}var L=F._createRequest({method:P,endpoint:N,data:M,success:O,error:K});L.send()},I,G)},setOwner:function(F,I,J,H){var G=this;return v(function(N,K){var M=G.collectionName;if(typeof I==="string"){M+="/"+I}else{if(typeof I==="object"){M+="/"+I[i]}}M+="/_owner";var L=G._createRequest({method:"PUT",endpoint:M,data:{Owner:F},success:N,error:K});L.send()},J,H)},save:function(I,J,H){var G=this;var F=this.isNew(I);return v(function(N,K){function M(O){O.type=F?"create":"update";N(O)}function L(O){O.type=F?"create":"update";K(O)}if(F){return G.create(I,M,L)}else{return G.updateSingle(I,M,L)}},J,H)},isNew:function(F){return typeof F[i]==="undefined"}};s.Data=f;function n(F,G){this.longitude=F||0;this.latitude=G||0}s.GeoPoint=n;var g={unauthenticated:"unauthenticated",masterKey:"masterKey",invalidAuthentication:"invalidAuthentication",authenticated:"authenticated"};s.AuthStatus=g;function j(F,I,K,H){if(F.masterKey){return v(function(M,L){M({status:g.masterKey})},K,H)}if(!F.token){return v(function(M,L){M({status:g.unauthenticated})},K,H)}var G;if(K){G=function(L){if(L&&L.code===601){K({status:g.invalidAuthentication})}else{H(L)}}}var J=I(K,G);if(J){J=J.then(function(L){return{status:g.authenticated,user:L.result}},function(L){if(L&&L.code===601){return{status:g.invalidAuthentication}}else{throw L}})}return J}s.prototype.authInfo=function(G,F){return j(this.setup,B.bind(this.Users.getById,this.Users,"me"),G,F)};var d=function(H){H._loginSuccess=function(J){var I=J.result;this.setAuthorization(I.access_token,I.token_type)};H._logoutSuccess=function(){this.clearAuthorization()};H.register=function(N,L,K,M,J){a(N,"username");a(L,"password");var I={Username:N,Password:L};B.extend(I,K);return this.create(I,M,J)};H.login=function(M,K,L,J){var I=this;return v(function(P,N){var O=new w(I.setup,{method:"POST",endpoint:"oauth/token",data:{username:M,password:K,grant_type:"password"},authHeaders:false,parse:w.parsers.single,success:function(){I._loginSuccess.apply(I,arguments);P.apply(null,arguments)},error:N});O.send()},L,J)};H.currentUser=function(K,J){var I=this;return v(function(M,L){j(I.setup,B.bind(I.getById,I,"me")).then(function(N){if(typeof N.user!=="undefined"){M({result:N.user})}else{M({result:null})}},function(N){L(N)})},K,J)};H.changePassword=function(O,K,N,L,M,J){var I=this;return v(function(S,P){var R="Users/changepassword";if(L){R+="?keepTokens=true"}var Q=new w(I.setup,{method:"POST",endpoint:R,data:{Username:O,Password:K,NewPassword:N},authHeaders:false,parse:w.parsers.single,success:S,error:P});Q.send()},M,J)};H.logout=function(K,J){var I=this;return v(function(N,L){var M=new w(I.setup,{method:"GET",endpoint:"oauth/logout",success:function(){I._logoutSuccess.apply(I,arguments);N.apply(null,arguments)},error:function(O){if(O.code===301){I.clearAuthorization()}L.apply(null,arguments)}});M.send()},K,J)};H._loginWithProvider=function(K,M,L){var J={Identity:K};var I=this;return v(function(P,N){var O=new w(I.setup,{method:"POST",endpoint:"Users",data:J,authHeaders:false,parse:w.parsers.single,success:function(){I._loginSuccess.apply(I,arguments);P.apply(null,arguments)},error:N});O.send()},M,L)};H._linkWithProvider=function(J,L,M,K){var I=this;return v(function(P,N){var O=new w(I.setup,{method:"POST",endpoint:"Users/"+L+"/link",data:J,parse:w.parsers.single,success:P,error:N});O.send()},M,K)};H._unlinkFromProvider=function(M,L,N,K){var J={Provider:M};var I=this;return v(function(Q,O){var P=new w(I.setup,{method:"POST",endpoint:"Users/"+L+"/unlink",data:J,parse:w.parsers.single,success:Q,error:O});P.send()},N,K)};H.loginWithFacebook=function(K,L,J){var I={Provider:"Facebook",Token:K};return H._loginWithProvider(I,L,J)};H.linkWithFacebook=function(L,K,M,J){var I={Provider:"Facebook",Token:K};return H._linkWithProvider(I,L,M,J)};H.unlinkFromFacebook=function(J,K,I){return H._unlinkFromProvider("Facebook",J,K,I)};H.loginWithADFS=function(K,L,J){var I={Provider:"ADFS",Token:K};return H._loginWithProvider(I,L,J)};H.linkWithADFS=function(L,K,M,J){var I={Provider:"ADFS",Token:K};return H._linkWithProvider(I,L,M,J)};H.unlinkFromADFS=function(J,K,I){return H._unlinkFromProvider("ADFS",J,K,I)};H.loginWithLiveID=function(K,L,J){var I={Provider:"LiveID",Token:K};return H._loginWithProvider(I,L,J)};H.linkWithLiveID=function(L,K,M,J){var I={Provider:"LiveID",Token:K};return H._linkWithProvider(I,L,M,J)};H.unlinkFromLiveID=function(J,K,I){return H._unlinkFromProvider("LiveID",J,K,I)};H.loginWithGoogle=function(K,L,J){var I={Provider:"Google",Token:K};return H._loginWithProvider(I,L,J)};H.linkWithGoogle=function(L,K,M,J){var I={Provider:"Google",Token:K};return H._linkWithProvider(I,L,M,J)};H.unlinkFromGoogle=function(J,K,I){return H._unlinkFromProvider("Google",J,K,I)};H.loginWithTwitter=function(K,L,M,J){var I={Provider:"Twitter",Token:K,TokenSecret:L};return H._loginWithProvider(I,M,J)};H.linkWithTwitter=function(L,K,M,N,J){var I={Provider:"Twitter",Token:K,TokenSecret:M};return H._linkWithProvider(I,L,N,J)};H.unlinkFromTwitter=function(J,K,I){return H._unlinkFromProvider("Twitter",J,K,I)};H.setAuthorization=function G(I,J){this.setup.token=I;this.setup.tokenType=J};H.clearAuthorization=function F(){this.setAuthorization(null,null)}};var p=function(F){F.getUploadUrl=function(){return s.buildUrl(this.setup)+this.collectionName};F.getDownloadUrl=function(G){return s.buildUrl(this.setup)+this.collectionName+"/"+G+"/Download"};F._getUpdateUrl=function(G){return this.collectionName+"/"+G+"/Content"};F.getUpdateUrl=function(G){return s.buildUrl(this.setup)+this._getUpdateUrl(G)};F.updateContent=function(G,J,K,I){var H=this;return v(function(O,L){var N=H._getUpdateUrl(G);var M=H._createRequest({method:"PUT",endpoint:N,data:J,success:O,error:L});M.send()},K,I)};F.getDownloadUrlById=function(G,J,I){var H=this;return v(function(M,K){var L=H._createRequest({method:"GET",endpoint:H.collectionName+"/"+G,parse:w.parsers.single,success:function(N){M(N.result.Uri)},error:K});L.send()},J,I)}};var D={WindowsPhone:1,Windows:2,Android:3,iOS:4,OSX:5,Blackberry:6,Nokia:7,Unknown:100};s.PushCallbacks={};function o(F){this._el=F;this.notifications=F.data("Push/Notifications");this.devices=F.data("Push/Devices")}o.prototype={ensurePushIsAvailable:function(){var F=(typeof window!=="undefined"&&window.plugins&&window.plugins.pushNotification);if(!F){throw new c("The push notification plugin is not available. Ensure that the pushNotification plugin is included and use after `deviceready` event has been fired.")}},currentDevice:function(F){this.ensurePushIsAvailable();if(arguments.length===0){F=this._el.setup._emulatorMode}if(!window.cordova){throw new c("Error: currentDevice() can only be called from within a hybrid mobile app, after 'deviceready' event has been fired.")}if(!this._currentDevice){this._currentDevice=new b(this)}this._currentDevice.emulatorMode=F;return this._currentDevice},register:function(K,M,I){this.ensurePushIsAvailable();var J=this.currentDevice();var H=this;K=K||{};if(K.android){K.android.senderID=K.android.projectNumber||K.android.senderID}var F=function(O,P){var N=new e(O);P(N)};var G=function(O,P){var N=C.fromEverliveError(O);P(N)};var L=function(O,R,P){var N=J._getPlatformType(device.platform);var Q=N===D.iOS;if(Q&&K.iOS){Q=K.iOS.clearBadge!==false}if(Q){H.clearBadgeNumber().then(function(){F(O,R)},function(S){G(S,P)})}else{F(O,R)}};return v(function(O,N){J.enableNotifications(K,function(Q){var R=Q.token;var P=K.customParameters;J.getRegistration().then(function(){J.updateRegistration(P,function(){L(R,O,N)},function(S){G(S,N)})},function(S){if(S.code===801){J.register(P,function(){L(R,O,N)},N)}else{G(S,N)}})},function(Q){var P=C.fromPluginError(Q);N(P)})},M,I)},unregister:function(H,G){this.ensurePushIsAvailable();var F=this.currentDevice();return F.disableNotifications.apply(F,arguments)},updateRegistration:function(F,I,H){this.ensurePushIsAvailable();var G=this.currentDevice();return G.updateRegistration.apply(G,arguments)},setBadgeNumber:function(F,K,I){this.ensurePushIsAvailable();F=parseInt(F);if(isNaN(F)){return v(function(M,L){L(new c("The badge must have a numeric value"))},K,I)}var H={};var G=this.currentDevice();var J=G._getDeviceId();H.Id="HardwareId/"+encodeURIComponent(J);H.BadgeCounter=F;return v(function(M,L){G._pushHandler.devices.updateSingle(H).then(function(){if(window.plugins&&window.plugins.pushNotification){return window.plugins.pushNotification.setApplicationIconBadgeNumber(M,L,F)}else{return M()}},L)},K,I)},clearBadgeNumber:function(G,F){this.ensurePushIsAvailable();return this.setBadgeNumber(0,G,F)},getRegistration:function(H,G){this.ensurePushIsAvailable();var F=this.currentDevice();return F.getRegistration.apply(F,arguments)},send:function(G,H,F){this.ensurePushIsAvailable();return this.notifications.create.apply(this.notifications,arguments)},areNotificationsEnabled:function(G,I,H){this.ensurePushIsAvailable();G=G||{};var F=window.plugins.pushNotification;return v(function(K,J){F.areNotificationsEnabled(K,J,G)},I,H)}};var b=function(F){this._pushHandler=F;this._initSuccessCallback=null;this._initErrorCallback=null;this._globalFunctionSuffix=null;this.pushSettings=null;this.pushToken=null;this.isInitialized=false;this.isInitializing=false;this.emulatorMode=false};b.prototype={enableNotifications:function(F,H,G){this.pushSettings=this._cleanPlatformsPushSettings(F);return v(B.bind(this._initialize,this),H,G)},disableNotifications:function(H,G){var F=this;return this.unregister().then(function(){return v(function(M,K){if(F.emulatorMode){M()}else{var I=window.plugins.pushNotification;var L;var J=F._getPlatformType(device.platform);if(J===D.WindowsPhone){L={channelName:F.pushSettings.wp8.channelName}}I.unregister(function(){F.isInitialized=false;M()},K,L)}},H,G)},G)},getRegistration:function(H,F){var G=encodeURIComponent(this._getDeviceId());return this._pushHandler.devices.getById("HardwareId/"+G,H,F)},register:function(G,J,H){var F=this;var I={};if(G!==undefined){I.Parameters=G}return this._populateRegistrationObject(I).then(function(){return F._pushHandler.devices.create(I,J,H)},H)},unregister:function(H,F){var G=encodeURIComponent(device.uuid);return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+G},H,F)},updateRegistration:function(G,J,H){var F=this;var I={};if(G!==undefined){I.Parameters=G}return this._populateRegistrationObject(I).then(function(){I.Id="HardwareId/"+encodeURIComponent(I.HardwareId);return F._pushHandler.devices.updateSingle(I,J,H)},H)},_initializeInteractivePush:function(G,M,K){var I=window.plugins.pushNotification;var J=G.interactiveSettings;var F=[];if(G.alert){F.push(I.UserNotificationTypes.Alert)}if(G.badge){F.push(I.UserNotificationTypes.Badge)}if(G.sound){F.push(I.UserNotificationTypes.Sound)}var L=function(N){var O=B.find(J.actions,function(P){return P.identifier===N});return O};var H=B.map(J.categories,function(N){return{identifier:N.identifier,actionsForDefaultContext:B.map(N.actionsForDefaultContext,L),actionsForMinimalContext:B.map(N.actionsForMinimalContext,L)}});I.registerUserNotificationSettings(M,K,{types:F,categories:H})},_initialize:function(Q,O){var S=this;if(this.isInitializing){O(new c("Push notifications are currently initializing."));return}if(!this.emulatorMode&&(!window.navigator||!window.navigator.globalization)){O(new c("The globalization plugin is not initialized."));return}if(!this.emulatorMode&&(!window.plugins||!window.plugins.pushNotification)){O(new c("The push notifications plugin is not initialized."));return}this._initSuccessCallback=Q;this._initErrorCallback=O;if(this.isInitialized){this._deviceRegistrationSuccess(this.pushToken);return}if(this.emulatorMode){setTimeout(function(){S._deviceRegistrationSuccess("fake_push_token")},1000);return}this.isInitializing=true;var R=this._globalFunctionSuffix;if(!R){R=Date.now().toString();this._globalFunctionSuffix=R}var G=window.plugins.pushNotification;var J=this._getPlatformType(device.platform);if(J===D.iOS){var L="apnCallback_"+R;s.PushCallbacks[L]=B.bind(this._onNotificationAPN,this);var N=this.pushSettings.iOS;this._validateIOSSettings(N);N.ecb="Everlive.PushCallbacks."+L;G.register(B.bind(this._successfulRegistrationAPN,this),B.bind(this._failedRegistrationAPN,this),N)}else{if(J===D.Android){var F="gcmCallback_"+R;s.PushCallbacks[F]=B.bind(this._onNotificationGCM,this);var I=this.pushSettings.android;this._validateAndroidSettings(I);I.ecb="Everlive.PushCallbacks."+F;G.register(B.bind(this._successSentRegistrationGCM,this),B.bind(this._errorSentRegistrationGCM,this),I)}else{if(J===D.WindowsPhone){var K="wp8Callback_"+R;var P="wp8RegistrationSuccessCallback_"+R;var H="wp8RegistrationErrorCallback_"+R;s.PushCallbacks[K]=B.bind(this._onNotificationWP8,this);s.PushCallbacks[P]=B.bind(this._deviceRegistrationSuccessWP,this);s.PushCallbacks[H]=B.bind(this._deviceRegistrationFailed,this);var M=this.pushSettings.wp8;this._validateWP8Settings(M);M.ecb="Everlive.PushCallbacks."+K;M.uccb="Everlive.PushCallbacks."+P;M.errcb="Everlive.PushCallbacks."+H;G.register(B.bind(this._successSentRegistrationWP8,this),B.bind(this._errorSentRegistrationWP8,this),M)}else{throw new c("The current platform is not supported: "+device.platform)}}}},_deviceRegistrationSuccessWP:function(F){this._deviceRegistrationSuccess(F.uri)},_validateAndroidSettings:function(F){if(!F.senderID){throw new c("Sender ID (project number) is not set in the android settings.")}},_validateWP8Settings:function(F){if(!F.channelName){throw new c("channelName is not set in the WP8 settings.")}},_validateIOSSettings:function(F){},_cleanPlatformsPushSettings:function(G){var I={};G=G||{};var F=function F(K,J,L){if(!G[J]){return}K[J]=K[J]||{};var N=G[J];var M=K[J];B.each(L,function(O){if(N.hasOwnProperty(O)){M[O]=N[O]}})};F(I,"iOS",["badge","sound","alert","interactiveSettings"]);F(I,"android",["senderID","projectNumber"]);F(I,"wp8",["channelName"]);var H=["notificationCallbackAndroid","notificationCallbackIOS","notificationCallbackWP8"];B.each(H,function(J){var K=G[J];if(K){if(typeof K!=="function"){throw new c('The "'+J+'" of the push settings should be a function')}I[J]=G[J]}});if(G.customParameters){I.customParameters=G.customParameters}return I},_populateRegistrationObject:function(H,I,G){var F=this;return v(function(K,J){if(!F.pushToken){throw new c("Push token is not available.")}F._getLocaleName(function(L){var R=F._getDeviceId();var P=device.model;var N=F._getPlatformType(device.platform);var O=h.determine().name();var M=F.pushToken;var S=L.value;var Q=device.version;H.HardwareId=R;H.HardwareModel=P;H.PlatformType=N;H.PlatformVersion=Q;H.TimeZone=O;H.PushToken=M;H.Locale=S;K()},J)},I,G)},_getLocaleName:function(G,F){if(this.emulatorMode){G({value:"en_US"})}else{navigator.globalization.getLocaleName(function(H){G(H)},F);navigator.globalization.getLocaleName(function(H){},F)}},_getDeviceId:function(){return device.uuid},_getPlatformType:function(G){var F=G.toLowerCase();switch(F){case"ios":case"iphone":case"ipad":return D.iOS;case"android":return D.Android;case"wince":return D.WindowsPhone;case"win32nt":return D.WindowsPhone;default:return D.Unknown}},_deviceRegistrationFailed:function(F){this.pushToken=null;this.isInitializing=false;this.isInitialized=false;if(this._initErrorCallback){this._initErrorCallback({error:F})}},_deviceRegistrationSuccess:function(F){this.pushToken=F;this.isInitializing=false;this.isInitialized=true;if(this._initSuccessCallback){this._initSuccessCallback({token:F})}},_successfulRegistrationAPN:function(G){var F=this;if(this.pushSettings.iOS&&this.pushSettings.iOS.interactiveSettings){this._initializeInteractivePush(this.pushSettings.iOS,function(){F._deviceRegistrationSuccess(G)},function(H){throw new c("The interactive push configuration is incorrect: "+H)})}else{this._deviceRegistrationSuccess(G)}},_failedRegistrationAPN:function(F){this._deviceRegistrationFailed(F)},_successSentRegistrationGCM:function(F){},_successSentRegistrationWP8:function(F){},_errorSentRegistrationWP8:function(F){this._deviceRegistrationFailed(F)},_errorSentRegistrationGCM:function(F){this._deviceRegistrationFailed(F)},_onNotificationAPN:function(F){this._raiseNotificationEventIOS(F)},_onNotificationWP8:function(F){this._raiseNotificationEventWP8(F)},_onNotificationGCM:function y(F){switch(F.event){case"registered":if(F.regid.length>0){this._deviceRegistrationSuccess(F.regid)}break;case"message":this._raiseNotificationEventAndroid(F);break;case"error":if(!this.pushToken){this._deviceRegistrationFailed(F)}else{this._raiseNotificationEventAndroid(F)}break;default:this._raiseNotificationEventAndroid(F);break}},_raiseNotificationEventAndroid:function(F){if(this.pushSettings.notificationCallbackAndroid){this.pushSettings.notificationCallbackAndroid(F)}},_raiseNotificationEventIOS:function(F){if(this.pushSettings.notificationCallbackIOS){this.pushSettings.notificationCallbackIOS(F)}},_raiseNotificationEventWP8:function(F){if(this.pushSettings.notificationCallbackWP8){this.pushSettings.notificationCallbackWP8(F)}}};function c(){var F=Error.apply(this,arguments);F.name=this.name="EverliveError";this.message=F.message;Object.defineProperty(this,"stack",{get:function(){return F.stack}});return this}c.prototype=Object.create(Error.prototype);c.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}};var C=function(H,G,F){c.call(this,G);this.errorType=H;this.message=G;if(F!==undefined){this.additionalInformation=F}};C.prototype=Object.create(c.prototype);C.fromEverliveError=function(G){var F=new C(u.EverliveError,G.message,G);return F};C.fromPluginError=function(G){var H="A plugin error occurred";if(G){if(typeof G.error==="string"){H=G.error}else{if(typeof G.message==="string"){H=G.message}}}var F=new C(u.PluginError,H,G);return F};var u={EverliveError:1,PluginError:2};var e=function(F){this.token=F};var z=function(){this.Users=this.data("Users");d(this.Users);this.Files=this.data("Files");p(this.Files);this.push=new o(this)};t.push({name:"default",func:z});return s}));
